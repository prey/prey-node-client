<?xml version="1.0" ?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">

  <Bundle Version="$(var.ProductVersion)"
          UpgradeCode="3705236C-84E0-44DF-AA18-CEB47B436F1F">
    <BootstrapperApplicationRef Id="WixStandardBootstrapperApplication.RtfLicense" />
    <WixVariable Id="WixStdbaLicenseRtf" Value="..\assets\license.rtf" />

    <Variable Name="InstallFolder" Value="[WindowsFolder]Prey" />
    <Variable Name="LaunchTarget"
              Value="[InstallFolder]\versions\$(var.ProductVersion)\lib\conf\windows\prey-config.exe"/>

    <Chain>

      <!-- Will check if we have .NET 2.0 -->
      <PackageGroupRef Id="dotNet20" />

      <!-- Will install the prey msi package itself -->
      <PackageGroupRef Id="PreySetupPkg" />

    </Chain>
  </Bundle>

  <!-- We need to declare the `PackageGroup` Fragment here, or in other file -->
  <Fragment>

    <!-- See docs why we are not using NETFRAMEWORK20 -->
    <util:RegistrySearch Root="HKLM"
                         Key="SOFTWARE\Microsoft\Net Framework Setup\NDP\v2.0.50727"
                         Value="Version"
                         Variable="Netfx20Version" />

    <PackageGroup Id="dotNet20">
      <ExePackage Name="dotNet"
                  Compressed="no"
                  InstallCondition="NOT Netfx20Version OR (Netfx20Version &lt; v2.0.50727.42)"
                  DownloadUrl="http://download.microsoft.com/download/5/6/7/567758a3-759e-473e-bf8f-52154438565a/dotnetfx.exe">
        <ExitCode Value ="3010" Behavior="forceReboot" />
        <RemotePayload CertificatePublicKey="921112143477B18F6834E20EF13234C0E9F36331"
                       CertificateThumbprint="A25800BB7577F5854B3823B82228D94140D0244E"
                       Description="IExpress Setup"
                       Hash="A3625C59D7A2995FB60877B5F5324892A1693B2A"
                       ProductName="Microsoft .NET Framework 2.0"
                       Size="23510720"
                       Version="2.0.50727.42" />
      </ExePackage>
    </PackageGroup>

    <PackageGroup Id="PreySetupPkg">
      <MsiPackage
        Id="PreySetup"
        Compressed="yes"
        SourceFile="prey-$(var.ProductVersion)-win.msi"
        Vital="yes"
        DisplayInternalUI="yes"
        Visible="no">
        <MsiProperty Name="INSTALLLOCATION" Value="[InstallFolder]" />
      </MsiPackage>
    </PackageGroup>

  </Fragment>

</Wix>
